# 达梦数据库备份与还原

## 1. 归档管理

### 图形化启用归档模式

![image-20240319160529590](D:\code\docs\eric2250.github.io\docs\images\dm\image-20240319160529590.png)



![image-20240319160834052](D:\code\docs\eric2250.github.io\docs\images\dm\image-20240319160644837.png)

![image-20240319161022805](D:\code\docs\eric2250.github.io\docs\images\dm\image-20240319161022805.png)

### 命令行启用归档模式

```
--启用归档模式
alter database mount;

alter database archivelog;

alter database add archivelog 'DEST=/apps/dmdba/dmdbms/dmarch, TYPE=LOCAL, FILE_SIZE=64, SPACE_LIMIT=0, ARCH_FLUSH_BUF_SIZE=0';


alter database open;

--查看状态
select arch_mode from v$database;

select arch_name,arch_type,arch_dest,arch_file_size from v$dm_arch_ini;


alter system switch logfile;
/*
 cat /apps/dmdata/data/DMDB1/dmarch.ini 
#DaMeng Database Archive Configuration file
#this is comments

	ARCH_WAIT_APPLY      = 0        

[ARCHIVE_LOCAL1]
	ARCH_TYPE            = LOCAL        
	ARCH_DEST            = /apps/dmdba/dmdbms/dmarch        
	ARCH_FILE_SIZE       = 64        
	ARCH_SPACE_LIMIT     = 0        
	ARCH_FLUSH_BUF_SIZE  = 0        
	ARCH_HANG_FLAG       = 1 
	
	*/
```



## 2. 逻辑备份与还原

```
--逻辑导出(dexp)和逻辑导入(dimp)支持如下四种级别操作:
----数据库级(FULL):导出或导入整个数据库中的所有对象。
----用户级(OWNER):导出或导入一个或多个用户所拥有的所有对象。
----模式级(SCHEMAS):导出或导入一个或多个式下的所有对象。
----表级(TABLE):导出或导入一个或多个指定的表或表分区，
--创建测试数据#创建用户:
create user dexp identified by dameng123;
grant resource,dba to dexp;
--连接测试用户并创建测试表:
--conn dexp/dameng123;
create table dexp as select * from sysobjects;
--导出导入过程数据库要保持OPEN状态
select count(1) from dexp;

--全库导出
--]$dexp SYSDBA/SYSDBA file=full_01.dmp log=full1.log directory=/apps/dmdba/dmdbms/dmbak full=y
--删除测试数据:
drop table dexp ;
select count(1) from dexp;
--全库导入
--]$ dimp USERID=SYSDBA/SYSDBA file=full_01.dmp LOG=full2.log directory=/apps/dmdba/dmdbms/dmbak full=y table_exists_action=replace
--验证之前创建的测试表
select count(1) from dexp;
```



## 3. 联机备份与还原



## 4. 脱机备份与还原



